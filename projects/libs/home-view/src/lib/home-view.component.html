<article class="counter-list">
    <div class="header">
        <h3>{{ title }}</h3>
        <div class="view-mode-selector">
            <button mat-icon-button (click)="toggleViewMode('list')">
                <mat-icon>view_list</mat-icon>
            </button>
            <button mat-icon-button (click)="toggleViewMode('tile')">
                <mat-icon>grid_view</mat-icon>
            </button>
        </div>
    </div>

    @if (counterList$().length > 0 && showHint) {
        <div class="hint-container" (click)="updateHint()">
            <mat-icon class="hint-icon">lightbulb</mat-icon>
            <p class="hint-text">{{ currentHint }}</p>
            <button
                mat-icon-button
                class="hint-close"
                (click)="toggleHint()"
                (click)="$event.stopPropagation()">
                <mat-icon>close</mat-icon>
            </button>
        </div>
    }

    @if (viewMode === 'list') {
        <section cdkDropList (cdkDropListDropped)="onDrop($event)" class="counter-list-container">
            <div
                class="counter-item"
                *ngFor="let counter of orderedCounters()"
                cdkDrag
                (click)="navigateToDetailHandle(counter.id)"
                [style.background]="counter.color || 'var(--counter-default)'">
                <div class="counter-name">
                    <p>{{ counter.name }}</p>
                </div>
                <div class="decrement-button">
                    <button mat-mini-fab (click)="decrementCounterHandle($event, counter.id)">
                        @if (counter.defaultIncrement > 0) {
                            -
                        } @else {
                            +
                        }
                    </button>
                </div>
                <div class="counter-value">
                    <div
                        class="value-progress-border"
                        [style.--progress]="
                            getProgress(counter.initialValue, counter.goal, counter.value())
                        "
                        [class]="{ 'goal-reached': checkGoal(counter, counter.value()) }">
                        <button mat-fab>
                            {{ counter.value() | number: '1.0-2' }}
                        </button>
                    </div>
                </div>
                <div class="increment-button">
                    <button mat-fab (click)="incrementCounterHandle($event, counter.id)">
                        @if (counter.defaultIncrement > 0) {
                            +
                        }
                        {{ counter.defaultIncrement }}
                    </button>
                </div>
                <div class="drag-handle" cdkDragHandle>
                    <mat-icon>drag_indicator</mat-icon>
                </div>
            </div>
        </section>
    } @else {
        <div class="tile-grid">
            <section
                class="counter-tile"
                *ngFor="let counter of orderedCounters()"
                [class.pressed]="isTilePressed(counter.id)"
                [style.background]="counter.color || 'var(--counter-default)'">
                <div
                    class="tile-overlay"
                    libLongPress
                    (press)="handlePress($event, counter.id)"
                    (pressState)="handlePressState($event, counter.id)"></div>
                <div class="tile-content">
                    <div
                        class="value-progress-border"
                        [style.--progress]="
                            getProgress(counter.initialValue, counter.goal, counter.value())
                        "
                        [class]="{ 'goal-reached': checkGoal(counter, counter.value()) }">
                        <button mat-fab>
                            {{ counter.value() | number: '1.0-2' }}
                        </button>
                    </div>
                    <p class="tile-name">{{ counter.name }}</p>
                </div>
            </section>
        </div>
    }

    <section class="counter-list-empty" *ngIf="orderedCounters().length === 0">
        <div class="empty-state-content">
            <p class="icon">ðŸ“Š</p>
            <h4>No Counters Yet</h4>
            <p class="message">
                Start tracking anything you want to count - workouts, habits, goals, or anything
                else!
            </p>
            <div class="suggestions">
                <p>Try counting:</p>
                <ul>
                    <li>Daily steps</li>
                    <li>Workout sets</li>
                    <li>Books read</li>
                    <li>Water glasses</li>
                </ul>
            </div>
            <button mat-flat-button (click)="addCounterHandle()">
                <mat-icon>add</mat-icon>
                <span>Create Counter</span>
            </button>
        </div>
    </section>
</article>

<button
    mat-fab
    class="add-counter-button"
    (click)="addCounterHandle()"
    [class.animate-pulse]="counterList$().length === 0">
    <mat-icon>add</mat-icon>
</button>
